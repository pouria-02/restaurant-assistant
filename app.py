import streamlit as st
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_core.messages import HumanMessage
import os

# ฺฏุฑูุชู API Key ุงุฒ Secret
api_key = os.environ.get("GOOGLE_API_KEY")

# Google Gemini
MODEL_NAME = "gemini-2.0-flash-exp"
llm = ChatGoogleGenerativeAI(model=MODEL_NAME, api_key=api_key)

# ููู ููููู
menu = {
    "ูพุชุฒุง ูุงุฑฺฏุงุฑุชุง": "ุฎูุฑ ูุงุฒฺฉุ ุณุณ ฺฏูุฌูโูุฑูฺฏุ ูพูุฑ ููุชุฒุงุฑูุงุ ุฑุญุงู ุชุงุฒู",
    "ุจุฑฺฏุฑ ฺฉูุงุณฺฉ": "ฺฏูุดุช ฺฏูุณุงููุ ูุงู ุจุฑฺฏุฑุ ูพูุฑ ฺุฏุงุฑุ ฺฉุงููุ ฺฏูุฌูุ ุณุณ ูุฎุตูุต",
    "ุณุงูุงุฏ ุณุฒุงุฑ": "ฺฉุงูู ุฑููุ ูุฑุบ ฺฏุฑูโุดุฏูุ ูพูุฑ ูพุงุฑูุฒุงูุ ฺฉุฑูุชููุ ุณุณ ุณุฒุงุฑ",
    "ูพุงุณุชุง ุขููุฑุฏู": "ูพุงุณุชุงุ ุณุณ ุฎุงููโุงุ ูุฑุบุ ูุงุฑฺุ ูพูุฑ ูพุงุฑูุฒุงู",
}

# ุชุงุจุน ุฏุณุชุงุฑ ุฑุณุชูุฑุงู
def restaurant_assistant(question):
    system_prompt = (
        "ุชู ฺฉ ุฏุณุชุงุฑ ุฑุณุชูุฑุงู ูุณุช. ููุท ุฏุฑุจุงุฑูโ ุบุฐุงูุง ููู ุฒุฑ ูพุงุณุฎ ุจุฏู. "
        "ุงฺฏุฑ ุณุคุงู ุฑุจุท ุจู ููู ุง ููุงุฏ ุชุดฺฉูโุฏููุฏูโ ุขูโูุง ูุฏุงุดุชุ ุจฺฏู: "
        "ยซูุทูุง ููุท ุฏุฑุจุงุฑูโ ููู ุณูุงู ุจูุฑูุงุฏ.ยป\n\n"
        "ุงฺฏุฑ ฺฉุงุฑุจุฑ ุฏุฑุจุงุฑูโ ููุงุฏ ุชุดฺฉูโุฏููุฏูโ ูุฑ ุบุฐุง ูพุฑุณุฏุ "
        "ุฏุฑ ููุฑุฏ ุขู ูุงุฏู ุชูุถุญ ุจุฏูุ ุฎูุงุตุด ุฑุง ุจฺฏู ู ุงฺฏุฑ ูุงุจู ุชูู ุฏุฑ ุฎุงูู ุงุณุชุ "
        "ุจู ุทูุฑ ุฎูุงุตู ุฑูุด ุชููโุงุด ุฑุง ูู ุชูุถุญ ุจุฏู.\n\n"
        f"ููู:\n{menu}"
    )

    msg = [HumanMessage(content=f"{system_prompt}\n\nุณุคุงู ูุดุชุฑ: {question}")]
    response = llm.invoke(msg)
    return response.content

# ===== UI ูุฑุชุจ =====
st.title("๐ฝ๏ธ ุฏุณุชุงุฑ ุฑุณุชูุฑุงู")

# ุณุชููโูุง: ฺูพ ูููุ ุฑุงุณุช ุณูุงู ู ุฌูุงุจ
col1, col2 = st.columns([2, 3])

with col1:
    st.subheader("๐ ููู ุฑุณุชูุฑุงู")
    with st.expander("ููุงุด ููู"):
        for dish, ingredients in menu.items():
            st.write(f"**{dish}**: {ingredients}")

with col2:
    st.subheader("๐ฌ ูพุฑุณุด ู ูพุงุณุฎ")
    question = st.text_input("ุณูุงู ุฎูุฏ ุฑุง ุจูพุฑุณุฏ:")
    if question:
        answer = restaurant_assistant(question)
        st.markdown(f"**ูพุงุณุฎ ุฏุณุชุงุฑ:**\n\n{answer}")
